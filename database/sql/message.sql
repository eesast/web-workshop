-- 创建消息表
CREATE TABLE IF NOT EXISTS public.message (
  uuid UUID DEFAULT gen_random_uuid() NOT NULL,
  content TEXT NOT NULL,
  sender UUID NOT NULL,
  room UUID NOT NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  PRIMARY KEY (uuid),
  FOREIGN KEY (sender) REFERENCES public.user(uuid) ON DELETE CASCADE,
  FOREIGN KEY (room) REFERENCES public.room(uuid) ON DELETE CASCADE
);

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_message_room ON public.message(room);
CREATE INDEX IF NOT EXISTS idx_message_sender ON public.message(sender);
CREATE INDEX IF NOT EXISTS idx_message_created_at ON public.message(created_at);

-- 插入测试数据
INSERT INTO public.message (content, sender, room) VALUES
('大家好！欢迎来到项目讨论会', '00000000-0000-0000-0000-000000000000', '10000000-0000-0000-0000-000000000000'),
('今天我们要讨论新项目的开发计划', '00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000000'),
('好的，我已经准备好了', '00000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000000'),
('技术分享会开始了！', '00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001'),
('今天要分享什么技术呢？', '00000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000001'),
('团队建设活动开始！', '00000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000002');
