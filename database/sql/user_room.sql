-- 创建用户房间关系表
CREATE TABLE IF NOT EXISTS public.user_room (
  uuid UUID DEFAULT gen_random_uuid() NOT NULL,
  user UUID NOT NULL,
  room UUID NOT NULL,
  joined_at TIMESTAMP DEFAULT NOW(),
  PRIMARY KEY (uuid),
  FOREIGN KEY (user) REFERENCES public.user(uuid) ON DELETE CASCADE,
  FOREIGN KEY (room) REFERENCES public.room(uuid) ON DELETE CASCADE,
  UNIQUE(user, room)
);

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_user_room_user ON public.user_room(user);
CREATE INDEX IF NOT EXISTS idx_user_room_room ON public.user_room(room);

-- 插入测试数据
INSERT INTO public.user_room (user, room) VALUES
('00000000-0000-0000-0000-000000000000', '10000000-0000-0000-0000-000000000000'),
('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000000'),
('00000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000000'),
('00000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001'),
('00000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000001'),
('00000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000002')
ON CONFLICT (user, room) DO NOTHING;
